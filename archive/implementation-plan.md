# è‹¹æœå¤‡å¿˜å½•æ™ºèƒ½æœç´¢ MCP - å®Œæ•´å®æ–½æ–¹æ¡ˆ

**ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¶é—´**: 2025-11-04
**ç›®æ ‡ç”¨æˆ·**: é›¶ç¼–ç¨‹åŸºç¡€
**é¢„è®¡æ—¶é—´**: 5å‘¨ï¼ˆæ¯å‘¨5-7å°æ—¶ï¼‰

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [åˆ†é˜¶æ®µå®æ–½è®¡åˆ’](#åˆ†é˜¶æ®µå®æ–½è®¡åˆ’)
4. [è¯¦ç»†æŠ€æœ¯æ–‡æ¡£](#è¯¦ç»†æŠ€æœ¯æ–‡æ¡£)
5. [å¸¸è§é—®é¢˜è§£å†³](#å¸¸è§é—®é¢˜è§£å†³)
6. [å­¦ä¹ èµ„æº](#å­¦ä¹ èµ„æº)
7. [æˆæœ¬é¢„ç®—](#æˆæœ¬é¢„ç®—)

---

## é¡¹ç›®æ¦‚è¿°

### ğŸ¯ æ ¸å¿ƒç›®æ ‡

åˆ›å»ºä¸€ä¸ªæ™ºèƒ½å¤‡å¿˜å½•æœç´¢ç³»ç»Ÿï¼Œå®ç°ï¼š

1. **è‡ªåŠ¨å¯¼å‡º**ï¼šå®šæœŸå¯¼å‡ºè‹¹æœå¤‡å¿˜å½•åˆ°æœ¬åœ°æ•°æ®åº“
2. **è¯­ä¹‰æœç´¢**ï¼šä¸éœ€è¦ç²¾ç¡®å…³é”®è¯ï¼Œç†è§£æ„å›¾è¿›è¡Œæ¨¡ç³Šæœç´¢
3. **å¤šæ­¥æ¨ç†**ï¼šAI å¯ä»¥å…ˆæœç´¢â†’åˆ†æâ†’å†æ¬¡æœç´¢ï¼Œé€æ­¥å®šä½å†…å®¹
4. **iMessage é›†æˆ**ï¼šé€šè¿‡ Poke åœ¨ iMessage ä¸­ç›´æ¥æœç´¢å¤‡å¿˜å½•
5. **æ™ºèƒ½å®šä½**ï¼šç²¾å‡†å‘Šè¯‰ä½ å“ªä¸€ç¯‡å¤‡å¿˜å½•çš„å“ªäº›å†…å®¹ç›¸å…³

### âœ… ä¸ç°æœ‰æ–¹æ¡ˆçš„å¯¹æ¯”

| åŠŸèƒ½ | å½“å‰æ–¹æ¡ˆ | æœ¬é¡¹ç›®æ–¹æ¡ˆ |
|------|----------|------------|
| æœç´¢æ–¹å¼ | éšæœºé€‰50ç¯‡å†æœç´¢ | æ™ºèƒ½è¯­ä¹‰æœç´¢å…¨éƒ¨ç¬”è®° |
| æœç´¢ç²¾åº¦ | ä½ï¼ˆå¯èƒ½é—æ¼ï¼‰ | é«˜ï¼ˆå‘é‡ç›¸ä¼¼åº¦åŒ¹é…ï¼‰ |
| å¤šè½®æœç´¢ | ä¸æ”¯æŒ | æ”¯æŒï¼ˆAI é€æ­¥ç»†åŒ–ï¼‰ |
| è®¿é—®æ–¹å¼ | ä»… Claude Desktop | iMessage + Claude Desktop |
| è‡ªåŠ¨åŒ– | æ‰‹åŠ¨å¯¼å‡º | è‡ªåŠ¨ç›‘æ§åŒæ­¥ |

---

## æŠ€æœ¯æ¶æ„

### ğŸ—ï¸ ç³»ç»Ÿç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Apple Notes App                    â”‚
â”‚         ~/Library/Group Containers/                 â”‚
â”‚         group.com.apple.notes/NoteStore.sqlite      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ â‘  fswatch ç›‘æ§æ–‡ä»¶å˜åŒ–
                   â”‚    (60ç§’é˜²æŠ–)
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å¯¼å‡ºå±‚ï¼šapple-notes-to-sqlite            â”‚
â”‚                                                     â”‚
â”‚  âœ“ ä½¿ç”¨ AppleScript è¯»å–å¤‡å¿˜å½•                      â”‚
â”‚  âœ“ å¯¼å‡ºåˆ° SQLite: ~/notes.db                       â”‚
â”‚  âœ“ è¡¨ç»“æ„: folders + notes (id, title, body)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ â‘¡ Python è„šæœ¬è¯»å–å¹¶å¤„ç†
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç´¢å¼•å±‚ï¼šChromaDB + FastEmbed           â”‚
â”‚                                                     â”‚
â”‚  âœ“ å‘é‡æ•°æ®åº“: ~/notes_chroma/                     â”‚
â”‚  âœ“ åµŒå…¥æ¨¡å‹: BGE-small-en-v1.5 (384ç»´)             â”‚
â”‚  âœ“ å¢é‡æ›´æ–°: ä»…ç´¢å¼•æ–°å¢/ä¿®æ”¹çš„ç¬”è®°                  â”‚
â”‚  âœ“ å…ƒæ•°æ®: æ ‡é¢˜ã€æ—¥æœŸã€æ–‡ä»¶å¤¹ã€æ ‡ç­¾                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ â‘¢ MCP Protocol æš´éœ²å·¥å…·
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               MCP æœåŠ¡å™¨ï¼šFastMCP                   â”‚
â”‚                                                     â”‚
â”‚  å·¥å…·åˆ—è¡¨:                                          â”‚
â”‚  â€¢ search_notes(query, limit)                      â”‚
â”‚    â†’ è¯­ä¹‰æœç´¢å¤‡å¿˜å½•                                 â”‚
â”‚  â€¢ refine_search(query, date_range, folder)        â”‚
â”‚    â†’ ç²¾ç»†åŒ–æœç´¢ï¼ˆå¸¦è¿‡æ»¤æ¡ä»¶ï¼‰                        â”‚
â”‚  â€¢ refresh_index()                                 â”‚
â”‚    â†’ æ‰‹åŠ¨è§¦å‘é‡æ–°ç´¢å¼•                               â”‚
â”‚                                                     â”‚
â”‚  ä¼ è¾“æ¨¡å¼:                                          â”‚
â”‚  â€¢ stdio (Claude Desktop æœ¬åœ°)                     â”‚
â”‚  â€¢ SSE over HTTPS (Poke è¿œç¨‹)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ â‘£ MCP å®¢æˆ·ç«¯è°ƒç”¨
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å®¢æˆ·ç«¯å±‚                           â”‚
â”‚                                                     â”‚
â”‚  æ–¹å¼A: Claude Desktop (æœ¬åœ°æµ‹è¯•)                   â”‚
â”‚  æ–¹å¼B: Poke AI (iMessage äº¤äº’)                     â”‚
â”‚  æ–¹å¼C: Cursor / å…¶ä»– MCP å®¢æˆ·ç«¯                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ â‘¤ Function Calling
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LLM å±‚ï¼šDeepSeek V3                    â”‚
â”‚                                                     â”‚
â”‚  â€¢ æ¥æ”¶å·¥å…·å®šä¹‰                                     â”‚
â”‚  â€¢ å†³å®šè°ƒç”¨å“ªä¸ªå·¥å…·                                 â”‚
â”‚  â€¢ åˆ†æè¿”å›ç»“æœ                                     â”‚
â”‚  â€¢ å¤šè½®è°ƒç”¨ï¼ˆæ€è€ƒâ†’æœç´¢â†’å†æœç´¢ï¼‰                      â”‚
â”‚  â€¢ ç»¼åˆæœ€ç»ˆç­”æ¡ˆ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ æ ¸å¿ƒæŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç†ç”± |
|------|----------|------|
| **å¯¼å‡º** | apple-notes-to-sqlite | å‘½ä»¤è¡Œå·¥å…·ï¼Œæ˜“äºè‡ªåŠ¨åŒ– |
| **å­˜å‚¨** | SQLite | è½»é‡çº§ï¼Œæ— éœ€é¢å¤–æ•°æ®åº“æœåŠ¡ |
| **å‘é‡åº“** | ChromaDB | çº¯ Pythonï¼Œ1000æ¡ç¬”è®°æ€§èƒ½è¶³å¤Ÿ |
| **åµŒå…¥** | FastEmbed + BGE | æ— éœ€ PyTorchï¼ŒCPU ä¼˜åŒ– |
| **MCPæ¡†æ¶** | FastMCP | åˆå­¦è€…å‹å¥½ï¼Œè£…é¥°å™¨è¯­æ³• |
| **LLM** | DeepSeek V3 | ä¾¿å®œï¼Œæ”¯æŒ function calling |
| **è‡ªåŠ¨åŒ–** | fswatch + launchd | macOS åŸç”Ÿï¼Œç¨³å®šå¯é  |
| **é€šä¿¡** | Poke | å·²æ”¯æŒ MCPï¼Œç›´æ¥æ¥å…¥ |

---

## åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

### ğŸ“… ç¬¬1å‘¨ï¼šç¯å¢ƒæ­å»ºä¸æ‰‹åŠ¨å¯¼å‡º

**ç›®æ ‡**: å®Œæˆå¼€å‘ç¯å¢ƒé…ç½®ï¼Œå®ç°æ‰‹åŠ¨å¯¼å‡ºåŠŸèƒ½

#### æ­¥éª¤ 1.1ï¼šå®‰è£… Homebrewï¼ˆå¦‚æœæ²¡æœ‰ï¼‰

```bash
# æ‰“å¼€ç»ˆç«¯ï¼ˆTerminal.appï¼‰ï¼Œç²˜è´´ä»¥ä¸‹å‘½ä»¤
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# å®‰è£…å®Œæˆåï¼ŒéªŒè¯
brew --version
```

#### æ­¥éª¤ 1.2ï¼šå®‰è£… Python å·¥å…·

```bash
# å®‰è£… Python åŒ…ç®¡ç†å™¨ï¼ˆå¦‚æœæ²¡æœ‰ pipï¼‰
python3 -m ensurepip --upgrade

# å®‰è£…æ ¸å¿ƒä¾èµ–
pip3 install apple-notes-to-sqlite
pip3 install chromadb
pip3 install fastembed
pip3 install mcp

# å®‰è£…æ–‡ä»¶ç›‘æ§å·¥å…·
brew install fswatch
```

#### æ­¥éª¤ 1.3ï¼šæµ‹è¯•æ‰‹åŠ¨å¯¼å‡º

```bash
# å¯¼å‡ºå¤‡å¿˜å½•åˆ° SQLite æ•°æ®åº“
apple-notes-to-sqlite ~/notes.db

# æ£€æŸ¥å¯¼å‡ºç»“æœ
sqlite3 ~/notes.db "SELECT COUNT(*) FROM notes;"
sqlite3 ~/notes.db "SELECT title FROM notes LIMIT 5;"
```

**å¯èƒ½çš„é—®é¢˜**ï¼š
- âŒ **"æ“ä½œä¸è¢«å…è®¸"**: éœ€è¦æˆäºˆç»ˆç«¯å®Œå…¨ç£ç›˜è®¿é—®æƒé™
  - ç³»ç»Ÿè®¾ç½® â†’ éšç§ä¸å®‰å…¨ â†’ å®Œå…¨ç£ç›˜è®¿é—® â†’ æ·»åŠ  Terminal

#### æ­¥éª¤ 1.4ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•

```bash
# åˆ›å»ºé¡¹ç›®ç»“æ„
mkdir -p ~/Documents/apple-notes-mcp/{scripts,logs,config}

# ç›®å½•è¯´æ˜ï¼š
# - scripts/  å­˜æ”¾ Python è„šæœ¬
# - logs/     å­˜æ”¾è¿è¡Œæ—¥å¿—
# - config/   å­˜æ”¾é…ç½®æ–‡ä»¶
```

**ç¬¬1å‘¨äº¤ä»˜ç‰©**ï¼š
- âœ… æ‰€æœ‰å·¥å…·å®‰è£…å®Œæˆ
- âœ… èƒ½å¤Ÿæ‰‹åŠ¨å¯¼å‡ºå¤‡å¿˜å½•åˆ° ~/notes.db
- âœ… é¡¹ç›®ç›®å½•ç»“æ„åˆ›å»ºå®Œæˆ

**é¢„è®¡æ—¶é—´**: 4-6å°æ—¶

---

### ğŸ“… ç¬¬2å‘¨ï¼šå‘é‡æœç´¢ç³»ç»Ÿ

**ç›®æ ‡**: æ­å»ºæœ¬åœ°è¯­ä¹‰æœç´¢å¼•æ“

#### æ­¥éª¤ 2.1ï¼šåˆ›å»ºç´¢å¼•è„šæœ¬

åˆ›å»ºæ–‡ä»¶ `~/Documents/apple-notes-mcp/scripts/indexer.py`:

```python
#!/usr/bin/env python3
"""
å¤‡å¿˜å½•ç´¢å¼•è„šæœ¬
åŠŸèƒ½ï¼šè¯»å– SQLite ä¸­çš„å¤‡å¿˜å½•ï¼Œç”Ÿæˆå‘é‡å¹¶å­˜å…¥ ChromaDB
"""

import sqlite3
import chromadb
import os
from datetime import datetime

# ============ é…ç½® ============
NOTES_DB = os.path.expanduser("~/notes.db")
CHROMA_DB = os.path.expanduser("~/Documents/apple-notes-mcp/chroma_db")
LAST_SYNC_FILE = os.path.expanduser("~/Documents/apple-notes-mcp/.last_sync")

# ============ åˆå§‹åŒ– ChromaDB ============
client = chromadb.PersistentClient(path=CHROMA_DB)
collection = client.get_or_create_collection(
    name="apple_notes",
    metadata={"description": "Apple Notes è¯­ä¹‰æœç´¢"}
)

# ============ è¯»å–ä¸Šæ¬¡åŒæ­¥æ—¶é—´ ============
def get_last_sync_time():
    """è¯»å–ä¸Šæ¬¡åŒæ­¥æ—¶é—´ï¼Œå¦‚æœä¸å­˜åœ¨è¿”å› 1970-01-01"""
    try:
        with open(LAST_SYNC_FILE, 'r') as f:
            return f.read().strip()
    except FileNotFoundError:
        return "1970-01-01 00:00:00"

# ============ ä¿å­˜åŒæ­¥æ—¶é—´ ============
def save_sync_time():
    """ä¿å­˜å½“å‰æ—¶é—´ä¸ºæœ€ååŒæ­¥æ—¶é—´"""
    with open(LAST_SYNC_FILE, 'w') as f:
        f.write(datetime.now().strftime("%Y-%m-%d %H:%M:%S"))

# ============ å¢é‡ç´¢å¼• ============
def incremental_index():
    """ä»…ç´¢å¼•æ–°å¢æˆ–ä¿®æ”¹çš„å¤‡å¿˜å½•"""
    last_sync = get_last_sync_time()
    print(f"ä¸Šæ¬¡åŒæ­¥æ—¶é—´: {last_sync}")

    # è¿æ¥ SQLite
    conn = sqlite3.connect(NOTES_DB)
    cursor = conn.execute("""
        SELECT id, title, body, created, updated
        FROM notes
        WHERE updated > ?
        ORDER BY updated DESC
    """, (last_sync,))

    # è·å–å˜æ›´çš„ç¬”è®°
    changed_notes = cursor.fetchall()
    print(f"å‘ç° {len(changed_notes)} æ¡æ–°å¢æˆ–ä¿®æ”¹çš„ç¬”è®°")

    if not changed_notes:
        print("æ— éœ€æ›´æ–°")
        conn.close()
        return

    # æ‰¹é‡æ›´æ–°åˆ° ChromaDB
    for note_id, title, body, created, updated in changed_notes:
        # åˆå¹¶æ ‡é¢˜å’Œæ­£æ–‡
        content = f"{title}\n\n{body}" if title else body

        # å‡†å¤‡å…ƒæ•°æ®
        metadata = {
            "title": title or "(æ— æ ‡é¢˜)",
            "created": created,
            "updated": updated
        }

        # Upsertï¼ˆæ›´æ–°æˆ–æ’å…¥ï¼‰
        collection.upsert(
            ids=[note_id],
            documents=[content],
            metadatas=[metadata]
        )

        print(f"âœ“ ç´¢å¼•: {title[:50]}...")

    conn.close()
    save_sync_time()
    print(f"âœ… ç´¢å¼•å®Œæˆï¼å…±å¤„ç† {len(changed_notes)} æ¡ç¬”è®°")

# ============ å…¨é‡ç´¢å¼•ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰ ============
def full_index():
    """ç´¢å¼•æ‰€æœ‰å¤‡å¿˜å½•ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰"""
    print("æ‰§è¡Œå…¨é‡ç´¢å¼•...")

    conn = sqlite3.connect(NOTES_DB)
    cursor = conn.execute("SELECT id, title, body, created, updated FROM notes")

    all_notes = cursor.fetchall()
    print(f"æ€»å…± {len(all_notes)} æ¡ç¬”è®°")

    batch_size = 100
    for i in range(0, len(all_notes), batch_size):
        batch = all_notes[i:i+batch_size]

        ids = []
        documents = []
        metadatas = []

        for note_id, title, body, created, updated in batch:
            ids.append(note_id)
            documents.append(f"{title}\n\n{body}" if title else body)
            metadatas.append({
                "title": title or "(æ— æ ‡é¢˜)",
                "created": created,
                "updated": updated
            })

        collection.upsert(ids=ids, documents=documents, metadatas=metadatas)
        print(f"è¿›åº¦: {min(i+batch_size, len(all_notes))}/{len(all_notes)}")

    conn.close()
    save_sync_time()
    print("âœ… å…¨é‡ç´¢å¼•å®Œæˆï¼")

# ============ æµ‹è¯•æœç´¢ ============
def test_search(query, limit=5):
    """æµ‹è¯•æœç´¢åŠŸèƒ½"""
    print(f"\nğŸ” æœç´¢: {query}")
    results = collection.query(
        query_texts=[query],
        n_results=limit
    )

    print(f"æ‰¾åˆ° {len(results['documents'][0])} ä¸ªç»“æœ:\n")
    for i, (doc, metadata) in enumerate(zip(results['documents'][0], results['metadatas'][0])):
        print(f"--- ç»“æœ {i+1} ---")
        print(f"æ ‡é¢˜: {metadata['title']}")
        print(f"å†…å®¹: {doc[:200]}...")
        print(f"æ›´æ–°æ—¶é—´: {metadata['updated']}\n")

# ============ ä¸»å‡½æ•° ============
if __name__ == "__main__":
    import sys

    if len(sys.argv) > 1:
        command = sys.argv[1]

        if command == "full":
            full_index()
        elif command == "search":
            query = " ".join(sys.argv[2:]) if len(sys.argv) > 2 else "æœºå™¨å­¦ä¹ "
            test_search(query)
        else:
            print("ç”¨æ³•: python indexer.py [full|search <å…³é”®è¯>]")
    else:
        # é»˜è®¤æ‰§è¡Œå¢é‡ç´¢å¼•
        incremental_index()
```

#### æ­¥éª¤ 2.2ï¼šé¦–æ¬¡å…¨é‡ç´¢å¼•

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x ~/Documents/apple-notes-mcp/scripts/indexer.py

# é¦–æ¬¡è¿è¡Œï¼šå…¨é‡ç´¢å¼•
python3 ~/Documents/apple-notes-mcp/scripts/indexer.py full

# é¢„æœŸè¾“å‡ºï¼š
# æ‰§è¡Œå…¨é‡ç´¢å¼•...
# æ€»å…± XXX æ¡ç¬”è®°
# è¿›åº¦: 100/XXX
# âœ… å…¨é‡ç´¢å¼•å®Œæˆï¼
```

#### æ­¥éª¤ 2.3ï¼šæµ‹è¯•æœç´¢

```bash
# æµ‹è¯•è¯­ä¹‰æœç´¢
python3 ~/Documents/apple-notes-mcp/scripts/indexer.py search "æœºå™¨å­¦ä¹ é¡¹ç›®"

# åº”è¯¥çœ‹åˆ°ç›¸å…³ç¬”è®°çš„å‰200ä¸ªå­—ç¬¦
```

#### æ­¥éª¤ 2.4ï¼šæµ‹è¯•å¢é‡æ›´æ–°

```bash
# ä¿®æ”¹ä¸€æ¡å¤‡å¿˜å½•ï¼ˆåœ¨ Apple Notes ä¸­ï¼‰
# ç„¶åè¿è¡Œå¢é‡ç´¢å¼•
python3 ~/Documents/apple-notes-mcp/scripts/indexer.py

# é¢„æœŸè¾“å‡ºï¼š
# ä¸Šæ¬¡åŒæ­¥æ—¶é—´: 2025-11-04 10:30:00
# å‘ç° 1 æ¡æ–°å¢æˆ–ä¿®æ”¹çš„ç¬”è®°
# âœ“ ç´¢å¼•: XXX...
# âœ… ç´¢å¼•å®Œæˆï¼å…±å¤„ç† 1 æ¡ç¬”è®°
```

**ç¬¬2å‘¨äº¤ä»˜ç‰©**ï¼š
- âœ… æ‰€æœ‰ç¬”è®°å·²ç´¢å¼•åˆ° ChromaDB
- âœ… æœç´¢åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… å¢é‡æ›´æ–°æœºåˆ¶è¿è¡Œæ­£å¸¸

**é¢„è®¡æ—¶é—´**: 6-8å°æ—¶

---

### ğŸ“… ç¬¬3å‘¨ï¼šMCP æœåŠ¡å™¨å¼€å‘

**ç›®æ ‡**: åˆ›å»ºå®Œæ•´çš„ MCP æœåŠ¡å™¨ï¼Œæ”¯æŒ Claude Desktop

#### æ­¥éª¤ 3.1ï¼šå®‰è£… MCP SDK

```bash
# å®‰è£… FastMCPï¼ˆç®€åŒ–ç‰ˆ MCP SDKï¼‰
pip3 install fastmcp

# æˆ–ä½¿ç”¨å®˜æ–¹ SDK
pip3 install mcp
```

#### æ­¥éª¤ 3.2ï¼šåˆ›å»º MCP æœåŠ¡å™¨

åˆ›å»ºæ–‡ä»¶ `~/Documents/apple-notes-mcp/scripts/server.py`:

```python
#!/usr/bin/env python3
"""
Apple Notes MCP æœåŠ¡å™¨
æä¾›è¯­ä¹‰æœç´¢å’Œç´¢å¼•ç®¡ç†å·¥å…·
"""

from mcp.server.fastmcp import FastMCP
import chromadb
import sqlite3
import os
import subprocess
from datetime import datetime

# ============ é…ç½® ============
NOTES_DB = os.path.expanduser("~/notes.db")
CHROMA_DB = os.path.expanduser("~/Documents/apple-notes-mcp/chroma_db")

# ============ åˆå§‹åŒ– MCP å’Œ ChromaDB ============
mcp = FastMCP(name="apple-notes-search")
chroma_client = chromadb.PersistentClient(path=CHROMA_DB)
collection = chroma_client.get_or_create_collection("apple_notes")

# ============ å·¥å…· 1: æœç´¢å¤‡å¿˜å½• ============
@mcp.tool(description="åœ¨ Apple Notes ä¸­è¿›è¡Œè¯­ä¹‰æœç´¢ï¼Œæ‰¾åˆ°ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„å¤‡å¿˜å½•")
async def search_notes(query: str, limit: int = 5) -> str:
    """
    è¯­ä¹‰æœç´¢å¤‡å¿˜å½•

    å‚æ•°:
        query: æœç´¢å…³é”®è¯æˆ–é—®é¢˜ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
        limit: è¿”å›ç»“æœæ•°é‡ï¼ˆé»˜è®¤5æ¡ï¼‰

    è¿”å›:
        åŒ¹é…çš„å¤‡å¿˜å½•åˆ—è¡¨ï¼ˆåŒ…å«æ ‡é¢˜ã€å†…å®¹æ‘˜è¦ã€æ—¶é—´ï¼‰
    """
    try:
        results = collection.query(
            query_texts=[query],
            n_results=limit
        )

        if not results['documents'][0]:
            return "âŒ æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å¤‡å¿˜å½•"

        # æ ¼å¼åŒ–è¾“å‡º
        output = [f"ğŸ” æœç´¢: {query}\næ‰¾åˆ° {len(results['documents'][0])} ä¸ªç»“æœ:\n"]

        for i, (doc, metadata) in enumerate(zip(results['documents'][0], results['metadatas'][0])):
            output.append(f"### ç»“æœ {i+1}: {metadata['title']}")
            output.append(f"**æ›´æ–°æ—¶é—´**: {metadata['updated']}")
            output.append(f"**å†…å®¹**:\n{doc[:300]}...")
            output.append("")  # ç©ºè¡Œ

        return "\n".join(output)

    except Exception as e:
        return f"âŒ æœç´¢å¤±è´¥: {str(e)}"

# ============ å·¥å…· 2: ç²¾ç»†åŒ–æœç´¢ ============
@mcp.tool(description="ä½¿ç”¨è¿‡æ»¤æ¡ä»¶è¿›è¡Œæ›´ç²¾ç¡®çš„æœç´¢ï¼ˆæ”¯æŒæ—¥æœŸèŒƒå›´ã€å…³é”®è¯ç»„åˆï¼‰")
async def refine_search(
    query: str,
    date_after: str = None,
    date_before: str = None,
    limit: int = 5
) -> str:
    """
    ç²¾ç»†åŒ–æœç´¢

    å‚æ•°:
        query: æœç´¢æŸ¥è¯¢
        date_after: åªæœç´¢æ­¤æ—¥æœŸä¹‹åçš„ç¬”è®°ï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
        date_before: åªæœç´¢æ­¤æ—¥æœŸä¹‹å‰çš„ç¬”è®°ï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
        limit: è¿”å›ç»“æœæ•°é‡
    """
    try:
        # æ„å»ºè¿‡æ»¤æ¡ä»¶
        where = {}
        if date_after:
            where["updated"] = {"$gte": date_after}
        if date_before:
            if "updated" in where:
                where["updated"]["$lte"] = date_before
            else:
                where["updated"] = {"$lte": date_before}

        # æ‰§è¡Œæœç´¢
        results = collection.query(
            query_texts=[query],
            n_results=limit,
            where=where if where else None
        )

        if not results['documents'][0]:
            return "âŒ æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å¤‡å¿˜å½•"

        # æ ¼å¼åŒ–è¾“å‡º
        output = [f"ğŸ” ç²¾ç»†æœç´¢: {query}"]
        if date_after or date_before:
            output.append(f"ğŸ“… æ—¶é—´èŒƒå›´: {date_after or 'ä¸é™'} ~ {date_before or 'ä¸é™'}")
        output.append(f"æ‰¾åˆ° {len(results['documents'][0])} ä¸ªç»“æœ:\n")

        for i, (doc, metadata) in enumerate(zip(results['documents'][0], results['metadatas'][0])):
            output.append(f"### ç»“æœ {i+1}: {metadata['title']}")
            output.append(f"**æ›´æ–°æ—¶é—´**: {metadata['updated']}")
            output.append(f"**å†…å®¹**:\n{doc[:300]}...")
            output.append("")

        return "\n".join(output)

    except Exception as e:
        return f"âŒ æœç´¢å¤±è´¥: {str(e)}"

# ============ å·¥å…· 3: åˆ·æ–°ç´¢å¼• ============
@mcp.tool(description="æ‰‹åŠ¨è§¦å‘å¤‡å¿˜å½•å¯¼å‡ºå’Œé‡æ–°ç´¢å¼•")
async def refresh_index() -> str:
    """
    åˆ·æ–°ç´¢å¼•

    åŠŸèƒ½ï¼š
    1. é‡æ–°å¯¼å‡º Apple Notes åˆ° SQLite
    2. å¢é‡æ›´æ–°å‘é‡æ•°æ®åº“
    """
    try:
        # 1. å¯¼å‡ºå¤‡å¿˜å½•
        subprocess.run(
            ["apple-notes-to-sqlite", NOTES_DB],
            check=True,
            capture_output=True
        )

        # 2. è¿è¡Œç´¢å¼•è„šæœ¬
        indexer_path = os.path.expanduser("~/Documents/apple-notes-mcp/scripts/indexer.py")
        result = subprocess.run(
            ["python3", indexer_path],
            capture_output=True,
            text=True
        )

        return f"âœ… ç´¢å¼•åˆ·æ–°å®Œæˆ\n\n{result.stdout}"

    except Exception as e:
        return f"âŒ åˆ·æ–°å¤±è´¥: {str(e)}"

# ============ å·¥å…· 4: è·å–ç»Ÿè®¡ä¿¡æ¯ ============
@mcp.tool(description="æŸ¥çœ‹å¤‡å¿˜å½•æ•°é‡å’Œç´¢å¼•çŠ¶æ€")
async def get_stats() -> str:
    """è·å–ç»Ÿè®¡ä¿¡æ¯"""
    try:
        # ä» SQLite è·å–æ€»æ•°
        conn = sqlite3.connect(NOTES_DB)
        cursor = conn.execute("SELECT COUNT(*) FROM notes")
        total_notes = cursor.fetchone()[0]
        conn.close()

        # ä» ChromaDB è·å–ç´¢å¼•æ•°
        indexed_count = collection.count()

        return f"""
ğŸ“Š **å¤‡å¿˜å½•ç»Ÿè®¡**

- æ€»ç¬”è®°æ•°: {total_notes}
- å·²ç´¢å¼•æ•°: {indexed_count}
- ç´¢å¼•è¦†ç›–ç‡: {indexed_count/total_notes*100:.1f}%
- æ•°æ®åº“è·¯å¾„: {NOTES_DB}
- å‘é‡åº“è·¯å¾„: {CHROMA_DB}
        """.strip()

    except Exception as e:
        return f"âŒ è·å–ç»Ÿè®¡å¤±è´¥: {str(e)}"

# ============ å¯åŠ¨æœåŠ¡å™¨ ============
if __name__ == "__main__":
    print("ğŸš€ å¯åŠ¨ Apple Notes MCP æœåŠ¡å™¨...")
    print(f"ğŸ“‚ å¤‡å¿˜å½•æ•°æ®åº“: {NOTES_DB}")
    print(f"ğŸ—‚ï¸  å‘é‡æ•°æ®åº“: {CHROMA_DB}")
    print("âœ… æœåŠ¡å™¨è¿è¡Œä¸­ï¼Œç­‰å¾… MCP å®¢æˆ·ç«¯è¿æ¥...\n")

    # ä½¿ç”¨ stdio ä¼ è¾“ï¼ˆé€‚ç”¨äº Claude Desktopï¼‰
    mcp.run(transport="stdio")
```

#### æ­¥éª¤ 3.3ï¼šé…ç½® Claude Desktop

ç¼–è¾‘æ–‡ä»¶ `~/Library/Application Support/Claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "apple-notes": {
      "command": "python3",
      "args": [
        "/Users/ä½ çš„ç”¨æˆ·å/Documents/apple-notes-mcp/scripts/server.py"
      ]
    }
  }
}
```

**é‡è¦**: å°† `ä½ çš„ç”¨æˆ·å` æ›¿æ¢ä¸ºä½ çš„å®é™…ç”¨æˆ·åï¼ˆè¿è¡Œ `whoami` æŸ¥çœ‹ï¼‰

#### æ­¥éª¤ 3.4ï¼šæµ‹è¯• MCP æœåŠ¡å™¨

```bash
# 1. å®Œå…¨é€€å‡º Claude Desktopï¼ˆCmd+Qï¼‰

# 2. é‡æ–°æ‰“å¼€ Claude Desktop

# 3. åœ¨ Claude ä¸­æµ‹è¯•ï¼š
# "æœç´¢æˆ‘çš„å¤‡å¿˜å½•ä¸­å…³äºæœºå™¨å­¦ä¹ çš„å†…å®¹"
# "æŸ¥çœ‹å¤‡å¿˜å½•ç»Ÿè®¡ä¿¡æ¯"
# "åˆ·æ–°å¤‡å¿˜å½•ç´¢å¼•"
```

**å¦‚ä½•éªŒè¯æˆåŠŸ**ï¼š
- Claude ç•Œé¢åº•éƒ¨åº”æ˜¾ç¤º"ä½¿ç”¨äº† apple-notes çš„ search_notes å·¥å…·"
- è¿”å›ç»“æœåº”åŒ…å«ä½ çš„å®é™…å¤‡å¿˜å½•å†…å®¹

**è°ƒè¯•æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹ Claude æ—¥å¿—
tail -f ~/Library/Logs/Claude/mcp*.log

# æ‰‹åŠ¨æµ‹è¯• MCP æœåŠ¡å™¨
python3 ~/Documents/apple-notes-mcp/scripts/server.py
# åº”è¯¥çœ‹åˆ° "âœ… æœåŠ¡å™¨è¿è¡Œä¸­" æ¶ˆæ¯
```

**ç¬¬3å‘¨äº¤ä»˜ç‰©**ï¼š
- âœ… MCP æœåŠ¡å™¨è¿è¡Œæ­£å¸¸
- âœ… Claude Desktop å¯ä»¥è°ƒç”¨æœç´¢å·¥å…·
- âœ… 4ä¸ªå·¥å…·å…¨éƒ¨å¯ç”¨ï¼ˆsearch/refine/refresh/statsï¼‰

**é¢„è®¡æ—¶é—´**: 8-12å°æ—¶

---

### ğŸ“… ç¬¬4å‘¨ï¼šè‡ªåŠ¨åŒ–ä¸ç›‘æ§

**ç›®æ ‡**: å®ç°å…¨è‡ªåŠ¨åŒæ­¥ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ

#### æ­¥éª¤ 4.1ï¼šåˆ›å»ºåŒæ­¥è„šæœ¬

åˆ›å»ºæ–‡ä»¶ `~/Documents/apple-notes-mcp/scripts/sync.sh`:

```bash
#!/bin/bash

# ==========================
# Apple Notes è‡ªåŠ¨åŒæ­¥è„šæœ¬
# ==========================

LOG_FILE="$HOME/Documents/apple-notes-mcp/logs/sync.log"
NOTES_DB="$HOME/notes.db"
INDEXER="$HOME/Documents/apple-notes-mcp/scripts/indexer.py"

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p "$(dirname "$LOG_FILE")"

# è®°å½•å¼€å§‹æ—¶é—´
echo "========================================" >> "$LOG_FILE"
echo "$(date): å¼€å§‹åŒæ­¥" >> "$LOG_FILE"

# 1. å¯¼å‡ºå¤‡å¿˜å½•
echo "$(date): å¯¼å‡ºå¤‡å¿˜å½•..." >> "$LOG_FILE"
if apple-notes-to-sqlite "$NOTES_DB" >> "$LOG_FILE" 2>&1; then
    echo "$(date): âœ“ å¯¼å‡ºæˆåŠŸ" >> "$LOG_FILE"
else
    echo "$(date): âœ— å¯¼å‡ºå¤±è´¥" >> "$LOG_FILE"
    exit 1
fi

# 2. å¢é‡ç´¢å¼•
echo "$(date): æ›´æ–°ç´¢å¼•..." >> "$LOG_FILE"
if python3 "$INDEXER" >> "$LOG_FILE" 2>&1; then
    echo "$(date): âœ“ ç´¢å¼•æˆåŠŸ" >> "$LOG_FILE"
else
    echo "$(date): âœ— ç´¢å¼•å¤±è´¥" >> "$LOG_FILE"
    exit 1
fi

echo "$(date): âœ… åŒæ­¥å®Œæˆ" >> "$LOG_FILE"
echo "" >> "$LOG_FILE"
```

èµ‹äºˆæ‰§è¡Œæƒé™ï¼š
```bash
chmod +x ~/Documents/apple-notes-mcp/scripts/sync.sh
```

#### æ­¥éª¤ 4.2ï¼šæµ‹è¯•åŒæ­¥è„šæœ¬

```bash
# æ‰‹åŠ¨è¿è¡Œæµ‹è¯•
~/Documents/apple-notes-mcp/scripts/sync.sh

# æŸ¥çœ‹æ—¥å¿—
tail -20 ~/Documents/apple-notes-mcp/logs/sync.log
```

#### æ­¥éª¤ 4.3ï¼šé…ç½® fswatch ç›‘æ§

åˆ›å»ºå¯åŠ¨è„šæœ¬ `~/Documents/apple-notes-mcp/scripts/watch.sh`:

```bash
#!/bin/bash

# ==========================
# Apple Notes æ–‡ä»¶ç›‘æ§
# ==========================

NOTES_PATH="$HOME/Library/Group Containers/group.com.apple.notes"
SYNC_SCRIPT="$HOME/Documents/apple-notes-mcp/scripts/sync.sh"
LOG_FILE="$HOME/Documents/apple-notes-mcp/logs/watch.log"

echo "$(date): ğŸ” å¼€å§‹ç›‘æ§ Apple Notes..." | tee -a "$LOG_FILE"
echo "ç›‘æ§è·¯å¾„: $NOTES_PATH" | tee -a "$LOG_FILE"
echo "æŒ‰ Ctrl+C åœæ­¢" | tee -a "$LOG_FILE"

# ä½¿ç”¨ fswatch ç›‘æ§ï¼Œ60ç§’é˜²æŠ–
fswatch -o -l 60 "$NOTES_PATH" | while read event; do
    echo "$(date): æ£€æµ‹åˆ°å˜åŒ–ï¼Œè§¦å‘åŒæ­¥..." | tee -a "$LOG_FILE"
    "$SYNC_SCRIPT"
done
```

èµ‹äºˆæ‰§è¡Œæƒé™ï¼š
```bash
chmod +x ~/Documents/apple-notes-mcp/scripts/watch.sh
```

æ‰‹åŠ¨æµ‹è¯•ï¼š
```bash
# åœ¨ç»ˆç«¯è¿è¡Œï¼ˆä¼šä¸€ç›´ç›‘æ§ï¼‰
~/Documents/apple-notes-mcp/scripts/watch.sh

# ç„¶ååœ¨ Apple Notes ä¸­ä¿®æ”¹ä¸€æ¡ç¬”è®°
# ç­‰å¾…çº¦60ç§’ï¼Œåº”è¯¥çœ‹åˆ° "æ£€æµ‹åˆ°å˜åŒ–ï¼Œè§¦å‘åŒæ­¥..." æ¶ˆæ¯
```

#### æ­¥éª¤ 4.4ï¼šé…ç½® launchd å¼€æœºè‡ªå¯

åˆ›å»ºæ–‡ä»¶ `~/Library/LaunchAgents/com.user.apple-notes-sync.plist`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
    "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <!-- æœåŠ¡æ ‡è¯†ç¬¦ -->
    <key>Label</key>
    <string>com.user.apple-notes-sync</string>

    <!-- æ‰§è¡Œçš„å‘½ä»¤ -->
    <key>ProgramArguments</key>
    <array>
        <string>/bin/bash</string>
        <string>/Users/ä½ çš„ç”¨æˆ·å/Documents/apple-notes-mcp/scripts/watch.sh</string>
    </array>

    <!-- å¼€æœºè‡ªåŠ¨å¯åŠ¨ -->
    <key>RunAtLoad</key>
    <true/>

    <!-- å´©æºƒåè‡ªåŠ¨é‡å¯ -->
    <key>KeepAlive</key>
    <true/>

    <!-- æ ‡å‡†è¾“å‡ºæ—¥å¿— -->
    <key>StandardOutPath</key>
    <string>/Users/ä½ çš„ç”¨æˆ·å/Documents/apple-notes-mcp/logs/launchd.out</string>

    <!-- é”™è¯¯è¾“å‡ºæ—¥å¿— -->
    <key>StandardErrorPath</key>
    <string>/Users/ä½ çš„ç”¨æˆ·å/Documents/apple-notes-mcp/logs/launchd.err</string>
</dict>
</plist>
```

**é‡è¦**: æ›¿æ¢æ–‡ä»¶ä¸­çš„ `ä½ çš„ç”¨æˆ·å`

åŠ è½½æœåŠ¡ï¼š
```bash
# åŠ è½½ launchd æœåŠ¡
launchctl load ~/Library/LaunchAgents/com.user.apple-notes-sync.plist

# éªŒè¯æœåŠ¡è¿è¡ŒçŠ¶æ€
launchctl list | grep apple-notes

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# 12345  0  com.user.apple-notes-sync
```

åœæ­¢æœåŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š
```bash
launchctl unload ~/Library/LaunchAgents/com.user.apple-notes-sync.plist
```

#### æ­¥éª¤ 4.5ï¼šéªŒè¯è‡ªåŠ¨åŒ–

1. é‡å¯ Mac
2. æ‰“å¼€ Apple Notesï¼Œåˆ›å»ºæˆ–ä¿®æ”¹ä¸€æ¡ç¬”è®°
3. ç­‰å¾…60ç§’
4. æ£€æŸ¥æ—¥å¿—ï¼š
   ```bash
   tail -20 ~/Documents/apple-notes-mcp/logs/sync.log
   ```
5. åœ¨ Claude Desktop ä¸­æœç´¢åˆšæ‰ä¿®æ”¹çš„å†…å®¹ï¼ŒéªŒè¯å·²æ›´æ–°

**ç¬¬4å‘¨äº¤ä»˜ç‰©**ï¼š
- âœ… æ–‡ä»¶ç›‘æ§è‡ªåŠ¨è¿è¡Œ
- âœ… å¤‡å¿˜å½•ä¿®æ”¹åè‡ªåŠ¨åŒæ­¥
- âœ… å¼€æœºè‡ªåŠ¨å¯åŠ¨
- âœ… æ—¥å¿—æ­£å¸¸è®°å½•

**é¢„è®¡æ—¶é—´**: 3-5å°æ—¶

---

### ğŸ“… ç¬¬5å‘¨ï¼šPoke é›†æˆä¸ä¼˜åŒ–

**ç›®æ ‡**: å®ç° iMessage äº¤äº’ï¼Œå®Œæˆç«¯åˆ°ç«¯ç³»ç»Ÿ

#### æ­¥éª¤ 5.1ï¼šä¿®æ”¹ MCP æœåŠ¡å™¨æ”¯æŒ SSE

ç¼–è¾‘ `~/Documents/apple-notes-mcp/scripts/server.py`ï¼Œä¿®æ”¹æœ€åä¸€éƒ¨åˆ†ï¼š

```python
if __name__ == "__main__":
    import sys

    # è¯»å–å‘½ä»¤è¡Œå‚æ•°
    mode = sys.argv[1] if len(sys.argv) > 1 else "stdio"

    if mode == "sse":
        print("ğŸš€ å¯åŠ¨ SSE æœåŠ¡å™¨ï¼ˆç”¨äº Pokeï¼‰...")
        print("ğŸ“¡ ç›‘å¬ç«¯å£: 3000")
        mcp.run(transport="sse", port=3000)
    else:
        print("ğŸš€ å¯åŠ¨ stdio æœåŠ¡å™¨ï¼ˆç”¨äº Claude Desktopï¼‰...")
        mcp.run(transport="stdio")
```

æµ‹è¯• SSE æ¨¡å¼ï¼š
```bash
python3 ~/Documents/apple-notes-mcp/scripts/server.py sse

# åº”è¯¥çœ‹åˆ°ï¼š
# ğŸ“¡ ç›‘å¬ç«¯å£: 3000
```

#### æ­¥éª¤ 5.2ï¼šä½¿ç”¨ Cloudflare Tunnel æš´éœ²æœåŠ¡

```bash
# å®‰è£… cloudflared
brew install cloudflare/cloudflare/cloudflared

# å¯åŠ¨ä¸´æ—¶éš§é“
cloudflared tunnel --url http://localhost:3000
```

ä¼šè¾“å‡ºç±»ä¼¼ï¼š
```
2025-11-04 10:00:00 INF +--------------------------------------------------------------------------------------------+
2025-11-04 10:00:00 INF |  Your free tunnel has started! Visit it:                                                  |
2025-11-04 10:00:00 INF |    https://abc-def-ghi.trycloudflare.com                                                   |
2025-11-04 10:00:00 INF +--------------------------------------------------------------------------------------------+
```

**ä¿å­˜è¿™ä¸ª URL**ï¼ˆæ¯æ¬¡è¿è¡Œä¼šå˜åŒ–ï¼Œåç»­å¯é…ç½®å›ºå®šåŸŸåï¼‰

#### æ­¥éª¤ 5.3ï¼šé…ç½® Poke

1. è®¿é—® [poke.com](https://poke.com)
2. ç™»å½•ä½ çš„è´¦å·
3. è¿›å…¥ Settings â†’ Integrations â†’ New Integration
4. é€‰æ‹© MCP Server
5. é…ç½®ï¼š
   - Name: `Apple Notes Search`
   - Transport: `SSE`
   - URL: `https://ä½ çš„éš§é“åœ°å€.trycloudflare.com/sse`
   - Token: (æš‚æ—¶ç•™ç©º)
6. Save

#### æ­¥éª¤ 5.4ï¼šæµ‹è¯• iMessage é›†æˆ

1. æ‰“å¼€ iMessageï¼Œå‘é€æ¶ˆæ¯ç»™ Poke
2. æµ‹è¯•æœç´¢ï¼š
   ```
   æœç´¢æˆ‘çš„å¤‡å¿˜å½•ä¸­å…³äºæœºå™¨å­¦ä¹ çš„å†…å®¹
   ```
3. Poke åº”è¯¥è°ƒç”¨ä½ çš„ MCP æœåŠ¡å™¨å¹¶è¿”å›ç»“æœ

#### æ­¥éª¤ 5.5ï¼šä¼˜åŒ–æœç´¢ç»“æœæ ¼å¼

ä¸ºäº†æ›´å¥½çš„ iMessage æ˜¾ç¤ºï¼Œä¿®æ”¹ `search_notes` å‡½æ•°çš„è¾“å‡ºæ ¼å¼ï¼š

```python
@mcp.tool(description="åœ¨ Apple Notes ä¸­è¿›è¡Œè¯­ä¹‰æœç´¢")
async def search_notes(query: str, limit: int = 3) -> str:
    """ä¼˜åŒ–äº† iMessage æ˜¾ç¤ºçš„ç‰ˆæœ¬"""
    try:
        results = collection.query(
            query_texts=[query],
            n_results=limit
        )

        if not results['documents'][0]:
            return "æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å¤‡å¿˜å½• ğŸ˜”"

        # ç®€æ´æ ¼å¼ï¼ˆé€‚åˆæ‰‹æœºæ˜¾ç¤ºï¼‰
        output = [f"æ‰¾åˆ° {len(results['documents'][0])} æ¡ç›¸å…³ç¬”è®°:\n"]

        for i, (doc, metadata) in enumerate(zip(results['documents'][0], results['metadatas'][0])):
            # æˆªæ–­è¿‡é•¿çš„æ ‡é¢˜
            title = metadata['title'][:30] + "..." if len(metadata['title']) > 30 else metadata['title']

            # æˆªæ–­å†…å®¹
            content = doc[:150] + "..." if len(doc) > 150 else doc

            output.append(f"{i+1}. {title}")
            output.append(f"   {content}")
            output.append(f"   ğŸ“… {metadata['updated'][:10]}\n")

        return "\n".join(output)

    except Exception as e:
        return f"æœç´¢å¤±è´¥: {str(e)}"
```

#### æ­¥éª¤ 5.6ï¼šé…ç½®æŒä¹…åŒ–éš§é“ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½é‡æ–°å¯åŠ¨ cloudflaredï¼š

```bash
# ç™»å½• Cloudflare
cloudflared tunnel login

# åˆ›å»ºéš§é“
cloudflared tunnel create apple-notes-mcp

# é…ç½®è·¯ç”±
cloudflared tunnel route dns apple-notes-mcp notes.ä½ çš„åŸŸå.com

# åˆ›å»ºé…ç½®æ–‡ä»¶ ~/.cloudflared/config.yml
cat > ~/.cloudflared/config.yml <<EOF
tunnel: <ä½ çš„éš§é“ID>
credentials-file: /Users/ä½ çš„ç”¨æˆ·å/.cloudflared/<éš§é“ID>.json

ingress:
  - hostname: notes.ä½ çš„åŸŸå.com
    service: http://localhost:3000
  - service: http_status:404
EOF

# è¿è¡Œéš§é“
cloudflared tunnel run apple-notes-mcp
```

**ç¬¬5å‘¨äº¤ä»˜ç‰©**ï¼š
- âœ… MCP æœåŠ¡å™¨æ”¯æŒ SSE
- âœ… Cloudflare Tunnel è¿è¡Œ
- âœ… Poke æˆåŠŸé›†æˆ
- âœ… iMessage å¯ä»¥æœç´¢å¤‡å¿˜å½•

**é¢„è®¡æ—¶é—´**: 4-6å°æ—¶

---

## è¯¦ç»†æŠ€æœ¯æ–‡æ¡£

### ğŸ” ChromaDB æŸ¥è¯¢è¯­æ³•

```python
# åŸºç¡€æŸ¥è¯¢
collection.query(
    query_texts=["æœç´¢å†…å®¹"],
    n_results=5
)

# å¸¦è¿‡æ»¤æ¡ä»¶
collection.query(
    query_texts=["æœç´¢å†…å®¹"],
    n_results=5,
    where={"updated": {"$gte": "2025-01-01"}}
)

# å¤æ‚è¿‡æ»¤
collection.query(
    query_texts=["æœç´¢å†…å®¹"],
    where={
        "$and": [
            {"updated": {"$gte": "2025-01-01"}},
            {"title": {"$contains": "é¡¹ç›®"}}
        ]
    }
)
```

### ğŸ“Š å…ƒæ•°æ®è¿‡æ»¤æ“ä½œç¬¦

| æ“ä½œç¬¦ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `$eq` | ç­‰äº | `{"title": {"$eq": "ç¬”è®°"}}` |
| `$ne` | ä¸ç­‰äº | `{"title": {"$ne": "è‰ç¨¿"}}` |
| `$gt` | å¤§äº | `{"updated": {"$gt": "2025-01-01"}}` |
| `$gte` | å¤§äºç­‰äº | `{"updated": {"$gte": "2025-01-01"}}` |
| `$lt` | å°äº | `{"created": {"$lt": "2024-12-31"}}` |
| `$lte` | å°äºç­‰äº | `{"created": {"$lte": "2024-12-31"}}` |
| `$contains` | åŒ…å« | `{"title": {"$contains": "æœºå™¨å­¦ä¹ "}}` |
| `$and` | ä¸ | `{"$and": [{...}, {...}]}` |
| `$or` | æˆ– | `{"$or": [{...}, {...}]}` |

### ğŸ§  DeepSeek V3 å¤šæ­¥æœç´¢ç¤ºä¾‹

```python
# ç”¨æˆ·é—®é¢˜ï¼š"æ‰¾åˆ°æˆ‘æœ€è¿‘å†™çš„å…³äºæ·±åº¦å­¦ä¹ é¡¹ç›®çš„ç¬”è®°"

# ç¬¬1æ­¥ï¼šåˆå§‹æœç´¢
search_notes("æ·±åº¦å­¦ä¹  é¡¹ç›®", limit=10)

# DeepSeek åˆ†æï¼šå‘ç°ç»“æœå¤ªå¤šï¼Œéœ€è¦ç¼©å°èŒƒå›´
# ç¬¬2æ­¥ï¼šç²¾ç»†åŒ–æœç´¢
refine_search(
    query="æ·±åº¦å­¦ä¹  NLP é¡¹ç›®",
    date_after="2025-10-01",
    limit=5
)

# DeepSeek ç»¼åˆï¼šæ‰¾åˆ°3æ¡æœ€ç›¸å…³çš„ç¬”è®°ï¼Œè¿”å›ç»™ç”¨æˆ·
```

### ğŸ› ï¸ æ•…éšœæ’æŸ¥æŒ‡å—

#### é—®é¢˜ 1ï¼šapple-notes-to-sqlite æƒé™è¢«æ‹’ç»

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Operation not permitted
```

**è§£å†³æ–¹æ³•**ï¼š
1. æ‰“å¼€"ç³»ç»Ÿè®¾ç½®"
2. éšç§ä¸å®‰å…¨ â†’ å®Œå…¨ç£ç›˜è®¿é—®
3. ç‚¹å‡» `+` æ·»åŠ  Terminalï¼ˆæˆ–ä½ ä½¿ç”¨çš„ç»ˆç«¯ï¼‰
4. é‡å¯ç»ˆç«¯

#### é—®é¢˜ 2ï¼šChromaDB å¯¼å…¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ImportError: cannot import name 'ClientAPI'
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
pip3 install --upgrade chromadb
```

#### é—®é¢˜ 3ï¼šMCP æœåŠ¡å™¨æœªåœ¨ Claude ä¸­æ˜¾ç¤º

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] é…ç½®æ–‡ä»¶è·¯å¾„æ˜¯ç»å¯¹è·¯å¾„ï¼ˆä¸è¦ç”¨ `~`ï¼‰
- [ ] Python è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼ˆ`chmod +x`ï¼‰
- [ ] å®Œå…¨é€€å‡ºå¹¶é‡å¯ Claude Desktop
- [ ] æ£€æŸ¥æ—¥å¿—ï¼š`tail -f ~/Library/Logs/Claude/mcp*.log`

#### é—®é¢˜ 4ï¼šfswatch è§¦å‘å¤ªé¢‘ç¹

**è§£å†³æ–¹æ³•**ï¼š
å¢åŠ é˜²æŠ–å»¶è¿Ÿï¼š
```bash
fswatch -o -l 120 ...  # ä»60ç§’æ”¹ä¸º120ç§’
```

#### é—®é¢˜ 5ï¼šlaunchd æœåŠ¡æ²¡æœ‰å¯åŠ¨

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹æœåŠ¡åˆ—è¡¨
launchctl list | grep apple-notes

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
cat ~/Documents/apple-notes-mcp/logs/launchd.err

# é‡æ–°åŠ è½½
launchctl unload ~/Library/LaunchAgents/com.user.apple-notes-sync.plist
launchctl load ~/Library/LaunchAgents/com.user.apple-notes-sync.plist
```

---

## å­¦ä¹ èµ„æº

### ğŸ“š å¿…è¯»æ•™ç¨‹

1. **MCP å®˜æ–¹æ–‡æ¡£**
   - [Getting Started](https://modelcontextprotocol.io/introduction)
   - [Building MCP Servers](https://modelcontextprotocol.io/docs/concepts/servers)

2. **Microsoft MCP for Beginners**
   - ä»“åº“ï¼šhttps://github.com/microsoft/mcp-for-beginners
   - é‡ç‚¹ï¼šModule 3ï¼ˆç¬¬ä¸€ä¸ªæœåŠ¡å™¨ï¼‰ã€Module 11ï¼ˆæ•°æ®åº“é›†æˆï¼‰

3. **alejandro-ao MCP æ•™ç¨‹**
   - YouTubeï¼šhttps://youtu.be/Ek8JHgZtmcI
   - GitHubï¼šhttps://github.com/alejandro-ao/mcp-server-example
   - é€‚åˆé›¶åŸºç¡€

4. **ChromaDB Cookbook**
   - åœ°å€ï¼šhttps://cookbook.chromadb.dev
   - é‡ç‚¹ï¼šåŸºç¡€æŸ¥è¯¢ã€å…ƒæ•°æ®è¿‡æ»¤

5. **FastEmbed æ–‡æ¡£**
   - åœ°å€ï¼šhttps://qdrant.github.io/fastembed
   - é‡ç‚¹ï¼šæ¨¡å‹é€‰æ‹©ã€æ€§èƒ½ä¼˜åŒ–

### ğŸ¥ è§†é¢‘æ•™ç¨‹

- **ç»ˆç«¯åŸºç¡€**ï¼šæœç´¢ "Mac Terminal for Beginners"
- **Python å…¥é—¨**ï¼šCoursera "Python for Everybody"
- **MCP å®æˆ˜**ï¼šalejandro-ao çš„ YouTube é¢‘é“

### ğŸ’¬ ç¤¾åŒºæ”¯æŒ

- **MCP Discord**ï¼šhttps://discord.gg/modelcontextprotocol
- **r/ClaudeAI**ï¼šReddit ç¤¾åŒº
- **Stack Overflow**ï¼šæ ‡ç­¾ `model-context-protocol`

---

## æˆæœ¬é¢„ç®—

### ğŸ’° è¯¦ç»†æˆæœ¬åˆ†æ

#### ä¸€æ¬¡æ€§æˆæœ¬
| é¡¹ç›® | è´¹ç”¨ | å¤‡æ³¨ |
|------|------|------|
| Mac Studio M2 Max | $0 | å·²æœ‰ |
| å­¦ä¹ æ—¶é—´æŠ•å…¥ | 25-37å°æ—¶ | 5å‘¨ Ã— 5-7å°æ—¶/å‘¨ |

#### æœˆåº¦æˆæœ¬
| é¡¹ç›® | è´¹ç”¨ | å¤‡æ³¨ |
|------|------|------|
| DeepSeek API | $5-10 | ä¸ªäººä½¿ç”¨é‡ä½ |
| Poke è®¢é˜… | $3-30 | æ ¹æ®ä½¿ç”¨é‡ |
| Cloudflare Tunnel | $0 | å…è´¹ç‰ˆè¶³å¤Ÿ |
| **æœˆåº¦åˆè®¡** | **$8-40** | |

#### å¹´åº¦æˆæœ¬
| é¡¹ç›® | è´¹ç”¨ |
|------|------|
| DeepSeek API | $60-120 |
| Poke | $36-360 |
| ç”µè´¹ï¼ˆMac Studio 24å°æ—¶è¿è¡Œï¼‰ | ~$20 |
| **å¹´åº¦åˆè®¡** | **$116-500** |

### ğŸ’¡ æˆæœ¬ä¼˜åŒ–å»ºè®®

1. **DeepSeek API**ï¼š
   - ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è°ƒç”¨
   - è®¾ç½®æ¯æ—¥é™é¢ï¼ˆ$1-2/å¤©ï¼‰

2. **Poke**ï¼š
   - è¯„ä¼°ä½¿ç”¨é¢‘ç‡ï¼Œå¯èƒ½é€‰æ‹©è¾ƒä½å¥—é¤
   - æˆ–æ›¿ä»£æ–¹æ¡ˆï¼šç›´æ¥ç”¨ AppleScript å‘ iMessageï¼ˆå…è´¹ä½†å¤æ‚ï¼‰

3. **Cloudflare Tunnel**ï¼š
   - å…è´¹ç‰ˆè¶³å¤Ÿä¸ªäººä½¿ç”¨
   - å¦‚æœéœ€è¦å›ºå®šåŸŸåï¼Œè´­ä¹°åŸŸå $10-15/å¹´

---

## å¸¸è§é—®é¢˜ FAQ

### Q1ï¼šå¿…é¡»ä¼šç¼–ç¨‹å—ï¼Ÿ

**ç­”**ï¼šä¸å¿…ç²¾é€šï¼Œä½†éœ€è¦å­¦ä¹ åŸºç¡€ï¼š
- èƒ½çœ‹æ‡‚ Python ä»£ç ï¼ˆå˜é‡ã€å‡½æ•°ã€å¾ªç¯ï¼‰
- ä¼šç”¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼ˆ`cd`ã€`ls`ã€`python3`ï¼‰
- èƒ½ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆJSONã€YAMLï¼‰

æ¨èå…ˆèŠ±2-3å¤©å­¦ä¹  Python åŸºç¡€ã€‚

---

### Q2ï¼šèƒ½å¦è·³è¿‡æŸäº›æ­¥éª¤ï¼Ÿ

**å¯ä»¥ç®€åŒ–çš„**ï¼š
- ç¬¬4å‘¨ï¼ˆè‡ªåŠ¨åŒ–ï¼‰ï¼šå¯ä»¥å…ˆæ‰‹åŠ¨è¿è¡ŒåŒæ­¥è„šæœ¬
- ç¬¬5å‘¨ï¼ˆPokeï¼‰ï¼šå¯ä»¥åªç”¨ Claude Desktop

**ä¸èƒ½è·³è¿‡çš„**ï¼š
- ç¬¬1å‘¨ï¼ˆç¯å¢ƒæ­å»ºï¼‰
- ç¬¬2å‘¨ï¼ˆå‘é‡æœç´¢ï¼‰
- ç¬¬3å‘¨ï¼ˆMCP æœåŠ¡å™¨ï¼‰

---

### Q3ï¼šM1 æˆ– Intel Mac å¯ä»¥å—ï¼Ÿ

**ç­”**ï¼šå¯ä»¥ï¼æ‰€æœ‰æŠ€æœ¯éƒ½æ”¯æŒï¼š
- M1/M2/M3ï¼šæ€§èƒ½æœ€ä½³
- Intel Macï¼šä¹Ÿèƒ½è¿è¡Œï¼Œç¨æ…¢ä½†å¤Ÿç”¨

---

### Q4ï¼šæ•°æ®ä¼šä¸Šä¼ åˆ°äº‘ç«¯å—ï¼Ÿ

**ç­”**ï¼š
- âœ… **æœ¬åœ°**ï¼šå¤‡å¿˜å½•ã€SQLiteã€ChromaDB éƒ½åœ¨æœ¬åœ°
- âš ï¸ **äº‘ç«¯**ï¼šä»… DeepSeek API ä¼šæ¥æ”¶æœç´¢ç»“æœï¼ˆä¸æ˜¯å…¨éƒ¨ç¬”è®°ï¼‰
- ğŸ’¡ **å®Œå…¨æœ¬åœ°æ–¹æ¡ˆ**ï¼šå¯ä»¥æ›¿æ¢ä¸º Ollamaï¼ˆæœ¬åœ° LLMï¼‰ï¼Œä½†é…ç½®å¤æ‚

---

### Q5ï¼šæ”¯æŒä¸­æ–‡å¤‡å¿˜å½•å—ï¼Ÿ

**ç­”**ï¼šå®Œå…¨æ”¯æŒï¼
- ChromaDB æ”¯æŒå¤šè¯­è¨€
- BGE æ¨¡å‹å¯¹ä¸­æ–‡æ•ˆæœå¾ˆå¥½
- æœç´¢ä¸­è‹±æ–‡æ··åˆå†…å®¹æ— é—®é¢˜

---

### Q6ï¼šèƒ½æœç´¢é™„ä»¶ï¼ˆPDFã€å›¾ç‰‡ï¼‰å—ï¼Ÿ

**ç­”**ï¼š
- å½“å‰æ–¹æ¡ˆï¼šä¸æ”¯æŒ
- åæœŸæ‰©å±•ï¼š
  - PDFï¼šä½¿ç”¨ PyPDF2 æå–æ–‡æœ¬
  - å›¾ç‰‡ï¼šä½¿ç”¨ Tesseract OCR æˆ– CLIPï¼ˆmultimodalï¼‰
  - éš¾åº¦ï¼šä¸­ç­‰ï¼Œéœ€é¢å¤–2-3å‘¨

---

### Q7ï¼šå¤‡å¿˜å½•æ•°é‡ä¸Šé™ï¼Ÿ

**ç­”**ï¼š
- ChromaDB ç†è®ºæ”¯æŒç™¾ä¸‡çº§
- 1000æ¡ç¬”è®°ä¸‹ï¼Œæœç´¢é€Ÿåº¦ <50ms
- 1ä¸‡æ¡ç¬”è®°ä¸‹ï¼Œæœç´¢é€Ÿåº¦ <200ms
- å»ºè®®å®šæœŸæ¸…ç†æ—§ç¬”è®°å½’æ¡£

---

### Q8ï¼šå‡ºé”™äº†æ€ä¹ˆåŠï¼Ÿ

**æ­¥éª¤**ï¼š
1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
2. Google æœç´¢é”™è¯¯ä¿¡æ¯
3. åœ¨æœ¬æ–‡æ¡£"æ•…éšœæ’æŸ¥"éƒ¨åˆ†æŸ¥æ‰¾
4. åœ¨ MCP Discord ç¤¾åŒºæ±‚åŠ©
5. æä¾›å®Œæ•´é”™è¯¯æ—¥å¿—å’Œæ“ä½œæ­¥éª¤

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨æ£€æŸ¥æ¸…å•

### âœ… å‡†å¤‡é˜¶æ®µ
- [ ] ç¡®è®¤ Mac å‹å·å’Œ macOS ç‰ˆæœ¬ï¼ˆéœ€ macOS 12+ï¼‰
- [ ] å¤‡ä»½é‡è¦å¤‡å¿˜å½•ï¼ˆä»¥é˜²ä¸‡ä¸€ï¼‰
- [ ] é¢„ç•™ 25-37 å°æ—¶å­¦ä¹ æ—¶é—´
- [ ] åŠ å…¥ MCP Discord ç¤¾åŒº

### âœ… ç¬¬1å‘¨
- [ ] å®‰è£… Homebrew
- [ ] å®‰è£… Python å·¥å…·
- [ ] æµ‹è¯• apple-notes-to-sqlite
- [ ] åˆ›å»ºé¡¹ç›®ç›®å½•

### âœ… ç¬¬2å‘¨
- [ ] ç¼–å†™ç´¢å¼•è„šæœ¬
- [ ] å…¨é‡ç´¢å¼•æ‰€æœ‰ç¬”è®°
- [ ] æµ‹è¯•è¯­ä¹‰æœç´¢
- [ ] éªŒè¯å¢é‡æ›´æ–°

### âœ… ç¬¬3å‘¨
- [ ] åˆ›å»º MCP æœåŠ¡å™¨
- [ ] é…ç½® Claude Desktop
- [ ] æµ‹è¯•æ‰€æœ‰å·¥å…·
- [ ] éªŒè¯æœç´¢å‡†ç¡®æ€§

### âœ… ç¬¬4å‘¨
- [ ] ç¼–å†™åŒæ­¥è„šæœ¬
- [ ] é…ç½® fswatch ç›‘æ§
- [ ] è®¾ç½® launchd æœåŠ¡
- [ ] æµ‹è¯•è‡ªåŠ¨åŒ–æµç¨‹

### âœ… ç¬¬5å‘¨
- [ ] ä¿®æ”¹æœåŠ¡å™¨æ”¯æŒ SSE
- [ ] å®‰è£… Cloudflare Tunnel
- [ ] é…ç½® Poke é›†æˆ
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

---

## é¡¹ç›®æ–‡ä»¶æ¸…å•

å®Œæˆåï¼Œä½ çš„é¡¹ç›®ç›®å½•åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```
~/Documents/apple-notes-mcp/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ indexer.py          # ç´¢å¼•è„šæœ¬
â”‚   â”œâ”€â”€ server.py           # MCP æœåŠ¡å™¨
â”‚   â”œâ”€â”€ sync.sh             # åŒæ­¥è„šæœ¬
â”‚   â””â”€â”€ watch.sh            # ç›‘æ§è„šæœ¬
â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ sync.log            # åŒæ­¥æ—¥å¿—
â”‚   â”œâ”€â”€ watch.log           # ç›‘æ§æ—¥å¿—
â”‚   â”œâ”€â”€ launchd.out         # launchd è¾“å‡º
â”‚   â””â”€â”€ launchd.err         # launchd é”™è¯¯
â”œâ”€â”€ chroma_db/              # ChromaDB æ•°æ®ç›®å½•
â”œâ”€â”€ .last_sync              # ä¸Šæ¬¡åŒæ­¥æ—¶é—´æˆ³
â”œâ”€â”€ conversation-log.md     # å¯¹è¯è®°å½•ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â””â”€â”€ implementation-plan.md  # å®æ–½æ–¹æ¡ˆï¼ˆä½ æ­£åœ¨é˜…è¯»ï¼‰

~/notes.db                  # SQLite å¤‡å¿˜å½•æ•°æ®åº“

~/Library/LaunchAgents/
â””â”€â”€ com.user.apple-notes-sync.plist  # launchd é…ç½®

~/Library/Application Support/Claude/
â””â”€â”€ claude_desktop_config.json       # Claude MCP é…ç½®
```

---

## æˆåŠŸæ ‡å‡†

é¡¹ç›®å®Œæˆåï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… åœ¨ Apple Notes ä¸­åˆ›å»º/ä¿®æ”¹ç¬”è®°ï¼Œ60ç§’å†…è‡ªåŠ¨åŒæ­¥
2. âœ… åœ¨ Claude Desktop ä¸­æœç´¢ç¬”è®°ï¼Œè¿”å›æœ€ç›¸å…³çš„5æ¡
3. âœ… é€šè¿‡ iMessage å‘é€æœç´¢è¯·æ±‚ï¼ŒPoke è¿”å›ç»“æœ
4. âœ… ä½¿ç”¨ç²¾ç»†åŒ–æœç´¢ï¼ˆæ—¥æœŸèŒƒå›´ã€å…³é”®è¯ç»„åˆï¼‰
5. âœ… æ‰‹åŠ¨åˆ·æ–°ç´¢å¼•ï¼ˆå½“éœ€è¦ç«‹å³åŒæ­¥æ—¶ï¼‰
6. âœ… æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯ï¼ˆç¬”è®°æ€»æ•°ã€ç´¢å¼•çŠ¶æ€ï¼‰
7. âœ… å¤šæ­¥æœç´¢ï¼ˆAI å…ˆå¹¿æ³›æœç´¢â†’åˆ†æâ†’ç²¾ç»†æœç´¢ï¼‰

---

## ç»´æŠ¤è®¡åˆ’

### æ¯å‘¨
- [ ] æ£€æŸ¥åŒæ­¥æ—¥å¿—ï¼Œç¡®ä¿æ— é”™è¯¯
- [ ] æµ‹è¯•æœç´¢åŠŸèƒ½ï¼ŒéªŒè¯å‡†ç¡®æ€§

### æ¯æœˆ
- [ ] æ›´æ–° Python ä¾èµ–ï¼š`pip3 install --upgrade chromadb fastembed mcp`
- [ ] æ¸…ç†æ—§æ—¥å¿—ï¼š`rm ~/Documents/apple-notes-mcp/logs/*.log.old`

### æ¯å­£åº¦
- [ ] å¤‡ä»½ ChromaDB æ•°æ®åº“ï¼š`tar -czf chroma_backup.tar.gz ~/Documents/apple-notes-mcp/chroma_db`
- [ ] é‡æ–°è¯„ä¼° DeepSeek API ç”¨é‡å’Œæˆæœ¬

---

## æ‰©å±•åŠŸèƒ½ï¼ˆæœªæ¥ï¼‰

å®ŒæˆåŸºç¡€ç³»ç»Ÿåï¼Œå¯ä»¥è€ƒè™‘ï¼š

### ğŸ”® ç¬¬6å‘¨+ï¼šé«˜çº§åŠŸèƒ½

1. **OCR å›¾ç‰‡è¯†åˆ«**
   - é›†æˆ Tesseract
   - ç´¢å¼•å›¾ç‰‡ä¸­çš„æ–‡å­—
   - éš¾åº¦ï¼šä¸­

2. **çŸ¥è¯†å›¾è°±å¯è§†åŒ–**
   - ä½¿ç”¨ WeKnora
   - å±•ç¤ºç¬”è®°å…³ç³»ç½‘ç»œ
   - éš¾åº¦ï¼šé«˜

3. **è‡ªåŠ¨æ ‡ç­¾å»ºè®®**
   - ä½¿ç”¨ LLM åˆ†æå†…å®¹
   - è‡ªåŠ¨æ·»åŠ ç›¸å…³æ ‡ç­¾
   - éš¾åº¦ï¼šä¸­

4. **å®šæœŸæ‘˜è¦**
   - æ¯å‘¨å‘é€ç¬”è®°æ‘˜è¦åˆ°é‚®ç®±
   - æ€»ç»“æœ¬å‘¨é‡ç‚¹å†…å®¹
   - éš¾åº¦ï¼šä½

5. **è¯­éŸ³è¾“å…¥**
   - é›†æˆ Whisperï¼ˆè¯­éŸ³è½¬æ–‡å­—ï¼‰
   - iMessage å‘é€è¯­éŸ³æœç´¢
   - éš¾åº¦ï¼šä¸­

6. **å¤šè®¾å¤‡åŒæ­¥**
   - éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨
   - iPhone/iPad éšæ—¶è®¿é—®
   - éš¾åº¦ï¼šä¸­

---

## ç»“è¯­

è¿™ä¸ªé¡¹ç›®è™½ç„¶å¯¹é›¶åŸºç¡€ç”¨æˆ·æœ‰ä¸€å®šæŒ‘æˆ˜ï¼Œä½†æ¯ä¸ªæ­¥éª¤éƒ½æœ‰è¯¦ç»†è¯´æ˜ã€‚å…³é”®æ˜¯ï¼š

1. **å¾ªåºæ¸è¿›**ï¼šä¸è¦è·³æ­¥ï¼Œä¸€æ­¥ä¸€æ­¥æ¥
2. **å–„ç”¨æ—¥å¿—**ï¼šå‡ºé”™æ—¶æŸ¥çœ‹æ—¥å¿—æ˜¯æœ€å¿«çš„è°ƒè¯•æ–¹æ³•
3. **å¯»æ±‚å¸®åŠ©**ï¼šç¤¾åŒºå¾ˆå‹å¥½ï¼Œä¸è¦æ€•æé—®
4. **äº«å—è¿‡ç¨‹**ï¼šä»é›¶åˆ°ä¸€æ­å»ºç³»ç»Ÿï¼Œå¾ˆæœ‰æˆå°±æ„Ÿï¼

å¦‚æœé‡åˆ°å›°éš¾ï¼Œéšæ—¶å›åˆ°è¿™ä»½æ–‡æ¡£æŸ¥æ‰¾ç­”æ¡ˆã€‚ç¥ä½ æˆåŠŸæ­å»ºè‡ªå·±çš„æ™ºèƒ½å¤‡å¿˜å½•ç³»ç»Ÿï¼

---

**ç‰ˆæœ¬å†å²**ï¼š
- v1.0 (2025-11-04): åˆå§‹ç‰ˆæœ¬

**ä½œè€…**: Claude + ä½ 
**è®¸å¯**: ä¸ªäººä½¿ç”¨

---

*æœ¬æ–‡æ¡£å°†éšé¡¹ç›®è¿›å±•æŒç»­æ›´æ–°*
